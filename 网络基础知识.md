# 网络基础知识

### 线路是什么？

> **AS(自治系统)** 互联网是由不同网络组成的网络，自治系统是组成互联网的大型网络。更具体地说，自治系统（AS）是具有统一路由策略的巨型网络或网络群组。连接到互联网的每台计算机或设备都连接到一个 AS。可以认为 AS 类似于一个城镇的邮局。邮件从一个邮局到另一个邮局，直到到达正确的城镇为止，然后城镇的邮局将在该城镇内传递邮件。与之类似，数据包在整个互联网范围内通过从 AS 跳到 AS，直到它们到达包含其目的地互联网协议 (IP) 地址的 AS。该 AS 中的路由器将数据包发送到 IP 地址。每个 AS 都控制一组特定的 IP 地址，就像每个镇的邮局负责将邮件传递到该镇内的所有地址一样。给定 AS 可以控制的 IP 地址范围称为其“IP 地址空间”。大多数 AS 连接到其他几个 AS。如果一个 AS 仅连接到另一个 AS 并共享相同的路由策略，则可以将其视为第一个 AS 的子网。通常，每个 AS 由单个大型组织（例如互联网服务提供商（ISP）、大型企业技术公司、大学或政府机构）运营。
>
> **AS路由策略** AS路由策略是由 AS 控制的 IP 地址空间的列表以及与其连接的其他 AS 的列表。此信息对于将数据包路由到正确的网络是必需的。AS 使用边界网关协议（BGP）向互联网通知此信息。
>
> **IP地址空间** IP地址的指定群组或范围称为“IP 地址空间”。每个 AS 控制一定数量的 IP 地址空间。（一组 IP 地址也可以称为 IP 地址“块”。）这种情况类似于如果世界上的所有电话号码都按顺序列出，并且为每个电话公司分配一个范围：电话公司A 控制号码 000-0000 至 599-9999，电话公司 B 控制号码 600-0000 至 999-9999。如果爱丽丝拨打 555-2424 致电米歇尔，她的致电将通过电话公司 A 路由到米歇尔。如果她拨打 867-5309 致电珍妮，她的致电将通过电话公司 B 路由到珍妮。这就是 IP 地址空间的工作方式。假设 Acme 公司运营一家 AS，并控制一个 IP 地址范围，其中包括地址 192.0.2.253。如果计算机将数据包发送到 192.0.2.253，则该数据包最终将到达由 Acme 公司控制的 AS。如果该第一台计算机也将数据包发送到 198.51.100.255，则数据包将到达另一个 AS（尽管它们可能会在途中通过 Acme 公司的 AS）。
>
> **ASN(自治编号系统)** 每个 AS 都分配有一个官方编号或自治系统编号（ASN），类似于每个企业如何获得具有唯一官方编号的营业执照。但是，与企业不同，外部各方通常仅通过编号来引用 AS。AS 编号或 ASN 是介于 1 和 65534 之间的唯一 16 位数字或介于 131072 和 4294967294 之间的 32 位数字。它们通过这种格式表示：AS（数字）。例如，Cloudflare 的 ASN 是 AS13335。据不完全估计，全世界有超过 90,000 个 ASN 在使用。只有与网络间路由器的外部通信才需要 ASN（请参阅下面的“什么是 BGP？”）。AS 中的内部路由器和计算机可能不需要知道该 AS 的编号，因为它们仅与该 AS 内的设备通信。在分配 ASN 的管理机构给它编号之前，AS 必须满足某些资格。它必须具有唯一的路由策略，具有一定的大小，并且与其他 AS 具有多个连接。可用的 ASN 数量有限，如果过度分发它们，则供应会用光，路由也会变得更加复杂。
>
> **BGP(边界网关协议)** AS 通过边界网关协议（BGP）通知其到其他 AS 和路由器的路由策略。BGP 是在 AS 之间路由数据包的协议。如果没有这些路由信息，大规模运行互联网将很快变得不切实际：数据包将丢失或花费太长时间才能到达目的地。每个 AS 使用 BGP 通知它们负责的 IP 地址以及它们连接的其他 AS。BGP 路由器从世界各地的 AS 中获取所有这些信息，并将其放入称为路由表的数据库中，以确定从 AS 到 AS 的最快路径。当数据包到达时，BGP 路由器会参考其路由表来确定数据包接下来应转到哪个 AS。全世界有许多 AS，BGP 路由器不断更新其路由表。网络下线，新网络上线，AS 扩展或收缩其 IP 地址空间，所有这些信息都必须通过 BGP 通知，以便 BGP 路由器可以调整其路由表

这个世界的网络是由无数张局域网组成的，每一张比较大的局域网都会分配一个叫ASN的编号，在同一张局域网的设备可以直接沟通，而位于不同ASN的设备想要直接沟通就需要通过BGP来进行沟通，交换双方的路由信息。举个例子，我是电信用户，你也是电信用户，我俩都在电信的ASN内，可以直接沟通而无需BGP，但是如果你是联通用户，那么我电信局域网无法直接找到你的位置，就需要通过BGP询问联通局域网你的具体位置，这就是BGP的作用。

在国内，最大的三个网络运营商电信，联通和移动，各自都有自己的局域网，也有自己的ASN，我们的流量就是走的这些ASN来和服务器进行交流沟通。
下面就要介绍国内常见的ASN：

中国电信：

- AS4134：国内骨干网，俗称4134或163骨干网，ip以202.97开头. 定位于承载普通质量的互联网业务, 基建早, 带宽大, 便宜。
- AS4809：国内骨干网，俗称CN2，ip以59.43开头. CN2 相比较 163 网络, 带宽小, 稳定高速。
- AS23764：境外网，俗称CTGNet，用于面向企业客户提供定制化的国际互联网专线接入服务。

> CN2实际上分为CN2GT和CN2GIA两种。CN2GT又称半程CN2，因为其国内走163骨干网，国外走CN2；CN2GIA是全程CN2，国内国外都走CN2网络。

中国联通：

- AS4837：国内骨干网，俗称4837或联通169网络，IP以219.158开头，相当于电信中的163骨干网 。
- AS9929：国内骨干网，俗称9929或者CUII，定位类似于电信中的CN2，但是实际上和CN2完全不是一个水平。
- AS10099：境外网，俗称联通国际CUG，提供至大陆方向的差异化接入。

> 线路组合有以下几种：
>
> 内地 AS4837 + 境外 AS4837：最普通、最常见的联通 169 网络
>
> 内地 AS4837 + 境外 AS10099：应该算是高端线路。
>
> 内地 AS9929 + 境外 AS4837：很少见的路由。
>
> 内地 AS9929 + 境外 AS10099：联通高端线路。

中国移动：

- AS9808：国内网，俗称CMNET，对标电信普通网。
- AS24059：国内网，IP专网，用于承载包括软交换语音/信令、网络管理、电信运营支撑系统、自有业务等。
- AS58453：境外网，俗称CMI。
- AS58807：境外网，俗称CMIN2。

简单的总结就是：**CN2GIA >> 9929/cmin2/CN2GT >> 4837/4134/CMI**。对于电信用户而言，4134是普通网，CN2是优化网；对于联通用户而言，9929是优化网，4837是普通网；对于移动用户而言，CMIN2是优化网，CMI是普通网；

下面就要介绍一个重要概念：QOS（服务质量)

qos说白了就是“运营商为了保证服务质量的动态策略，具体表现为带宽限制、延迟升高等”，就是比如说平时我是G口网，但是晚高峰用的人多了，总带宽就这么大，运营商就对部分用户进行QOS，让大家都变慢，让我的G口网变成了100M网，这样虽然大家卡了，但不至于说有人没有网络。

被qos就是我们需要挑选线路的重要原因，因为无论哪个运营商，晚高峰期间都是优先确保优化网的网络，而去qos普通网的用户，所以有些线路平日里还行一到晚高峰就炸。

### ip质量是什么？

很多人会发现用商业机场科学上网会导致注册不了/访问网页被cf验证码骑脸/gpt降智/甚至直接被网站把ip搬了导致无法访问，这些问题都是因为你的访问ip的原因。前面我们说了你的真实请求通过代理协议加密后发送给服务器，服务器解密你的真实请求再转发给你的目标网址，这个时候目标网站收到你请求的时候看到的源ip就是你的服务器的ip，这个ip的质量高低就会影响你的体验。

所以到底什么是ip质量？
简单的说，就是网站会在数据库中查询你这个ip有没有作恶多端（爬虫/发垃圾邮件/是不是家庭宽带等），然后通过各个数据给你的评价，这个评价就是ip质量。

但是ip质量本身没有标准，因为各个网站采用的数据库都不同，很多都会用自己的数据库，所以我们用来评价的是最公开的数据库的评价，也有可能这个ip在公开数据库中是非常好的ip，但是就被你的网站拉黑了，也有可能，这些都是非常玄学的东西。
